<!-- src/app/features/cashier/sales-history/sales-history.component.html -->
<div class="page-layout">
  <app-navbar></app-navbar>
  <app-sidebar></app-sidebar>

  <main class="page-content">
    <div class="page-container">
      <!-- Header -->
      <div class="page-header">
        <div>
          <h1>Historial de Ventas</h1>
          <p>Consulta tus ventas realizadas</p>
        </div>
      </div>

      <!-- Estadísticas -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon blue">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-label">Mis Ventas</span>
            <span class="stat-value">{{ totalSales }}</span>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon green">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>
          <div class="stat-content">
            <span class="stat-label">Total Vendido</span>
            <span class="stat-value">{{ formatCurrency(totalRevenue) }}</span>
          </div>
        </div>
      </div>

      <!-- Mensajes -->
      <div *ngIf="error" class="alert alert-error">
        {{ error }}
      </div>

      <!-- Filtros -->
      <div class="filters-card">
        <div class="filter-group">
          <label>Fecha Inicio</label>
          <input
            type="date"
            [(ngModel)]="startDate"
            (ngModelChange)="filterSales()"
            class="filter-input"
          />
        </div>
        <div class="filter-group">
          <label>Fecha Fin</label>
          <input
            type="date"
            [(ngModel)]="endDate"
            (ngModelChange)="filterSales()"
            class="filter-input"
          />
        </div>
        <button class="btn-secondary" (click)="clearFilters()">
          Limpiar Filtros
        </button>
      </div>

      <!-- Loading -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando ventas...</p>
      </div>

      <!-- Tabla de Ventas -->
      <div *ngIf="!loading" class="table-card">
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Factura</th>
                <th>Fecha</th>
                <th>Subtotal</th>
                <th>IVA (19%)</th>
                <th>Total</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let sale of filteredSales">
                <td class="invoice-number">#{{ sale.idFactura }}</td>
                <td>{{ formatDate(sale.fecha) }}</td>
                <td>{{ formatCurrency(sale.subtotal) }}</td>
                <td>{{ formatCurrency(sale.iva) }}</td>
                <td class="total-amount">{{ formatCurrency(sale.total) }}</td>
                <td>
                  <button
                    class="btn-icon btn-view"
                    (click)="viewDetails(sale)"
                    title="Ver Detalle"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                  </button>
                </td>
              </tr>
              <tr *ngIf="filteredSales.length === 0">
                <td colspan="6" class="empty-state">
                  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="9" cy="21" r="1"></circle>
                    <circle cx="20" cy="21" r="1"></circle>
                    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                  </svg>
                  <p>No tienes ventas registradas</p>
                  <span>Realiza tu primera venta en el Punto de Venta</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal Detalle de Venta -->
<div class="modal-overlay" *ngIf="showDetailModal" (click)="closeDetailModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Detalle de Venta #{{ selectedSale?.idFactura }}</h2>
      <button class="modal-close" (click)="closeDetailModal()">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Información General -->
      <div class="invoice-info" *ngIf="selectedSale">
        <div class="info-row">
          <span class="info-label">Fecha:</span>
          <span class="info-value">{{ formatDate(selectedSale.fecha) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Factura:</span>
          <span class="info-value">#{{ selectedSale.idFactura }}</span>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="loadingDetails" class="loading-state">
        <div class="spinner"></div>
        <p>Cargando detalles...</p>
      </div>

      <!-- Productos Vendidos -->
      <div *ngIf="!loadingDetails && saleDetails.length > 0" class="details-table">
        <h3>Productos Vendidos</h3>
        <table class="invoice-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unit.</th>
              <th>Subtotal</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let detail of saleDetails">
              <td>{{ detail.nombreProducto || 'Producto #' + detail.idProducto }}</td>
              <td>{{ detail.cantidad }}</td>
              <td>{{ formatCurrency(detail.precioUnitario) }}</td>
              <td>{{ formatCurrency(detail.subtotal) }}</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Totales -->
      <div *ngIf="selectedSale" class="invoice-totals">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>{{ formatCurrency(selectedSale.subtotal) }}</span>
        </div>
        <div class="total-row">
          <span>IVA (19%):</span>
          <span>{{ formatCurrency(selectedSale.iva) }}</span>
        </div>
        <div class="total-row final">
          <span>Total:</span>
          <span>{{ formatCurrency(selectedSale.total) }}</span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeDetailModal()">
        Cerrar
      </button>
    </div>
  </div>
</div>
